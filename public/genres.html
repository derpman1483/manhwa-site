<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Genres - Manhwa Browser</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #080808;
            color: #ffffff;
            min-height: 100vh;
        }
        .header {
            background-color: #080808;
            padding: 20px;
            border-bottom: 1px solid #1a1a1a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 { font-size: 24px; font-weight: 600; }
        .nav-link {
            color: #ffffff;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 4px;
            transition: background-color 0.2s;
            margin-left: 10px;
        }
        .nav-link:hover { background-color: #1a1a1a; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .genres-header { margin-bottom: 30px; }
        .genres-header h2 { font-size: 32px; margin-bottom: 10px; }
        .tabs { display: flex; border-bottom: 1px solid #1a1a1a; margin-bottom: 20px; overflow-x: auto; }
        .tab-button {
            padding: 15px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            color: #888;
            white-space: nowrap;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
        }
        .tab-button.active { color: #ffffff; border-bottom-color: #ffffff; }
        .tab-button:hover { color: #ffffff; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .genres-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
        }
        .genre-item {
            background-color: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            color: #ffffff;
            display: block;
        }
        .genre-item:hover {
            background-color: #2a2a2a;
            border-color: #3a3a3a;
            transform: translateY(-2px);
        }
        .genre-name { font-size: 16px; font-weight: 600; }
        .loading { text-align: center; padding: 40px; color: #888; }
        .error { text-align: center; padding: 40px; color: #ff4444; }
    </style>
</head>
<body>
    <div class="header">
        <h1>All Genres</h1>
        <div>
            <a href="/index.html" class="nav-link">Browse</a>
            <a href="/search.html" class="nav-link">Search</a>
            <a href="/settings.html" class="nav-link">Settings</a>
            <a href="/profile.html" class="nav-link">Profile</a>
        </div>
    </div>

    <div class="container">
        <div class="genres-header">
            <h2>Browse by Genre</h2>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="openTab(event, 'all')">All Sources</button>
            <button class="tab-button" onclick="openTab(event, 'manga')">Manga</button>
            <button class="tab-button" onclick="openTab(event, 'shojo')">Shojo</button>
            <button class="tab-button" onclick="openTab(event, 'toongod')" id="toongodButton">Adult (18+)</button>
        </div>

        <div id="all" class="tab-content active">
            <div id="all-genres" class="genres-grid"><div class="loading">Loading genres...</div></div>
        </div>

        <div id="manga" class="tab-content">
            <div id="manga-genres" class="genres-grid"><div class="loading">Loading...</div></div>
        </div>

        <div id="shojo" class="tab-content">
            <div id="shojo-genres" class="genres-grid"><div class="loading">Loading...</div></div>
        </div>

        <div id="toongod" class="tab-content">
            <div id="toongod-genres" class="genres-grid"><div class="loading">Loading...</div></div>
        </div>
    </div>

    <script>
        const baseUrl = '/api/';
        let allGenres = [];
        let mangaGenres = [];
        let shojoGenres = [];
        let toongodGenres = [];

        const isAdultEnabled = () => JSON.parse(localStorage.getItem('adult')) === true;

        if(!isAdultEnabled()){
            document.getElementById('toongodButton').style.display = 'none';
        }

        function openTab(evt, tab) {
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tab).classList.add('active');
            if (evt) evt.target.classList.add('active');
            
            if (tab === 'all') renderGenres(allGenres, 'all-genres');
            else if (tab === 'manga') renderGenres(mangaGenres, 'manga-genres');
            else if (tab === 'shojo') renderGenres(shojoGenres, 'shojo-genres');
            else if (tab === 'toongod') {
                if(isAdultEnabled()) renderGenres(toongodGenres, 'toongod-genres');
                else { alert('Adult content disabled'); openTab(null, 'all'); }
            }
        }

        function createGenreSlug(genre) {
            return genre.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-+|-+$/g, '');
        }

        function renderGenres(genres, containerId) {
            const container = document.getElementById(containerId);
            if(!container) return;
            container.innerHTML = '';
            
            if (genres.length === 0) {
                container.innerHTML = '<div class="loading">No genres found</div>';
                return;
            }

            genres.forEach(genre => {
                const link = document.createElement('a');
                link.className = 'genre-item';
                link.href = `/genre/${createGenreSlug(genre)}`;
                link.innerHTML = `<div class="genre-name">${genre}</div>`;
                container.appendChild(link);
            });
        }

        async function loadGenres() {
            try {
                // Fixed: Fetching all 3 sources
                const [mangaRes, shojoRes, toongodRes] = await Promise.all([
                    fetch(`${baseUrl}genres?type=manga`),
                    fetch(`${baseUrl}genres?type=shojo`),
                    fetch(`${baseUrl}genres?type=toongod`)
                ]);
                
                mangaGenres = await mangaRes.json();
                shojoGenres = await shojoRes.json();
                
                if(isAdultEnabled()) {
                    toongodGenres = await toongodRes.json();
                } else {
                    toongodGenres = [];
                }
                
                // Combine and deduplicate
                const genreSet = new Set([...mangaGenres, ...shojoGenres, ...toongodGenres]);
                allGenres = Array.from(genreSet).sort();
                
                renderGenres(allGenres, 'all-genres');
            } catch (error) {
                console.error('Error loading genres:', error);
                document.getElementById('all-genres').innerHTML = '<div class="error">Error loading genres.</div>';
            }
        }

        document.addEventListener('DOMContentLoaded', loadGenres);
    </script>
</body>
</html>